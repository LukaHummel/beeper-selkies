#!/command/with-contenv bash

# Ensure /config directory exists (should be mounted as volume)
if [ ! -d "/config" ]; then
    echo "[init-beeper-config] ERROR: /config directory does not exist. Please mount a volume to /config"
    exit 1
fi

# Create Beeper config directories if they don't exist
if ! mkdir -p /config/.config/BeeperTexts \
              /config/.config/beeper \
              /config/.local/share/beeper \
              /config/.pki/nssdb; then
    echo "[init-beeper-config] ERROR: Failed to create Beeper config directories"
    exit 1
fi

# Fix ownership for abc user
# Note: The base image's s6-overlay handles PUID/PGID mapping to the abc user automatically
if ! chown -R abc:abc /config/.config \
                      /config/.local \
                      /config/.pki; then
    echo "[init-beeper-config] ERROR: Failed to set ownership on Beeper config directories"
    exit 1
fi

echo "[init-beeper-config] Beeper config directories initialized with correct permissions"
